{"cells":[{"metadata":{"_uuid":"b18f86038762f0d86c66bff74e495dfde8512b80"},"cell_type":"markdown","source":"**Are California Police biased?**\n\nWithin the past few years, racial prejudices of police officers has been a hot topic. Partly to address this debate, provide transperancy, and provide some notion of formal analysis, Stanford has released the Open Policing Project which aggregates data from various states in the USA, consisting of approximately 60 million traffic stops. Since I am a California native, and California is well known for being a highly liberal state, I decided to analyze the California traffic stop data. This notebook in R consists of my findings and analysis. My blog probabilitymeasure.blog will contain commentary and interpretation of this notebook."},{"metadata":{"trusted":true,"_uuid":"1ac2319904a07164ce600f47cf700ed039f51f41"},"cell_type":"code","source":"#load packages\nlibrary(readr)\nlibrary(ggplot2)\nlibrary(zoo)\nlibrary(data.table)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"0401702861b71d8c231653086074c4d2fd22729f"},"cell_type":"code","source":"#load data\nCA_cleaned <- read_csv(\"../input/CA_cleaned.csv\", \n    col_types = cols(county_fips = col_skip(), \n        driver_age = col_skip(), driver_race_raw = col_skip(), \n        ethnicity = col_skip(), fine_grained_location = col_skip(), \n        id = col_skip(), location_raw = col_skip(), \n        police_department = col_skip(), search_type_raw = col_skip(), \n        state = col_skip(), stop_time = col_skip(), \n        violation_raw = col_skip()))","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"bc9cee33d94a7f9ed9fb24afc5c41d3749a7a3a0"},"cell_type":"code","source":"dim(CA_cleaned)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"1293366bad3d379627573c32bba1ad56a8e7c16f"},"cell_type":"markdown","source":"As we can see the data is hyooge.\n\nWe have some missing data pertaining to the outcomes and the driver race, our variables of interest. The data is too large to try and impute it in a rigorous way (though we probably could), so for now we just remove it. Assuming that the missing data comes from the same distribution as our data set, the number of missing cases is inconsequential.\n\nLater, we will take a closer look at the cases with missing contraband, but for now we set it aside."},{"metadata":{"trusted":true,"_uuid":"45d538b91a64df8dd66cb63aed4525d488cb8207"},"cell_type":"code","source":"colMeans(is.na(CA_cleaned))","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"c9bf27d26e28252c2991a035be34461b0694c37b"},"cell_type":"code","source":"columns <- c('driver_race', 'stop_outcome', 'is_arrested')\nmiss_cntrbnd <- CA_cleaned[is.na(CA_cleaned$contraband_found),]\ndata <- CA_cleaned[complete.cases(CA_cleaned[, columns]),]\ndata$contraband_missing <- (CA_cleaned$contraband_found == 'NA')\nrm(CA_cleaned, columns)\nsum(data$contraband_missing)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"3282db51aa31dd368f5c94f2519cc597c68f4e2b"},"cell_type":"code","source":"colMeans(is.na(data))","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"9bd94ce2ab1a0e4ea301854c803cb4e8476ca4b7"},"cell_type":"code","source":"dim(data)\ndim(miss_cntrbnd)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"70ac599c070cb53556330c8a6e8f0dd3258f8028"},"cell_type":"markdown","source":"We don't lose too much.\nThe next block just recodes the variables to be slightly more useful. Take note of the `driver_age_raw` category. We won't be able to fit a model to the entire data without crashing, so we will look at subsets of the data. In particular, we will look at `driver_age_raw` at 2 and 3, which is the 15-25 and 25-32 age bracket, though almost all groups will get a look. We will also recode the violation and the dates. The missing values in `search_type` correspond to when a search was *not* conducted, so we can just add a string indicating that later. We also fill in the missing county name with a string instead of deleting those cases, as the missingness could be informative."},{"metadata":{"trusted":true,"_uuid":"9b14d3daac68773ac760074aa3e72f7d5553d125"},"cell_type":"code","source":"data$driver_gender <- (data$driver_gender == 'M') * 1\ndata$search_conducted <- data$search_conducted * 1\ndata$is_arrested <- data$is_arrested * 1\ndata$contraband_found <- data$contraband_found * 1\ndata$stop_date <- as.Date(data$stop_date, '%Y-%m-%d')\ndata$stop_date <- as.yearmon(data$stop_date)\ndata$search_type[data$search_conducted == 1 & is.na(data$search_type)] <- 'None'\n\n#looks like a logging error, we remove it\ndata <- data[!(data$driver_age_raw == '7'), ]\n\n#relabel the rest\ndata$driver_age_raw[data$driver_age_raw == '0-14'] <- 1\ndata$driver_age_raw[data$driver_age_raw == '15-25'] <- 2\ndata$driver_age_raw[data$driver_age_raw == '25-32'] <- 3\ndata$driver_age_raw[data$driver_age_raw == '33-39'] <- 4\ndata$driver_age_raw[data$driver_age_raw == '40-48'] <- 5\ndata$driver_age_raw[data$driver_age_raw == '49+'] <- 6\ndata$driver_age_raw <- as.numeric(data$driver_age_raw)\n\n\ndata$violation[data$violation == 'DUI'] <- 0\ndata$violation[data$violation == 'Equipment'] <- 1\ndata$violation[data$violation == 'Moving violation'] <- 2\ndata$violation[data$violation == 'Other'] <- 3\ndata$violation <- as.numeric(data$violation)\n\ndata$county_name[is.na(data$county_name)] <- 'Missing'\ndata$count <- 1\n\n#data$year <- year(data$stop_date)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"d762ca05af5c8b9ada10dd410f3a04f13f6c5aaf"},"cell_type":"code","source":"head(data)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"e81b1c63d30f54e92c36ed6554d7d3d089dc4114"},"cell_type":"markdown","source":"**Description of the data**\nThe data we will work with contains the variables seen in the header above. Most of it is fairly straightforward. `stop_date` and `county_name` give the year and month of the stop. Presently, there is not strong reason to believe that days of the week or month will have a significant effect on stop outcomes (would you believe that Cops give more tickets on a Monday? Maybe, but do you believe it would cause statistically significant differences in practically census-level data?) and so we take the courser date-time to just be the month and year. This also eases plotting down below. Later we will further collapse that into year for the regression models unless a convincing reason is found/given to not do this. The time frame of the data ranges from 2009 to 2016. There are 55 counties in all, if the `\"Missing\"` county is included.\n\n`search_conducted` is a binary indicator denoting whether a search was done, where 1 means \"yes\". We also have `search_type` which indicates how/why the search was conducted. Of particular note are the categories `\"Probable Cause\"` and `\"Incident to Arrest\"`.  \n\n`contraband_found` is an indicator for whether some paraphilinilia was found. Unfortunately, we do not have data on what the contraband was, but it could range from (say) drugs to weapons.\n\n`stop_outcome` is a categorical variable indicating what the end result of the traffic stop was. Of particular note is `\"Verbal Warning\"`, which we will analyze later. \n\nFinally, `is_arrested` is clear. It's an indicator whether that person was arrested or not. What is not clear, is why the arrest occurred. It is not true that the arrest always comes after a search, as some individuals were arrested, THEN searched as noted by `\"Incident to Arrest\"'. \n\n**Time Series Plotting**\n\nWe plot some time series trends in the data, grouped by race, after some aggregation to make the data actually readable. (If you try to plot this without aggregation, having thousands of stops on the same day for years makes the data too noisy to interpret).\n"},{"metadata":{"trusted":true,"_uuid":"848a62ab13f506b742d78cddee0515f107138158"},"cell_type":"code","source":"setDT(data)\ntime_data <- data[, lapply(.SD, sum, na.rm=TRUE),\n           by=list(stop_date, driver_race),\n                   .SDcols=c('search_conducted',\n                             'is_arrested',\n                             'contraband_found',\n                             'contraband_missing',\n                             'count')]\nhead(time_data)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"9777f59caf5284a5fd7387b8b237cb775019c870"},"cell_type":"code","source":"options(repr.plot.width=8, repr.plot.height=4)\nggplot(data = time_data, aes(x = stop_date, y = search_conducted / count, colour = driver_race)) + \n       geom_line(size = 0.60) +\n       ggtitle('Rates of Searches After Stop') +\n       xlab('Stop Date') +\n       ylab('Rate of Searches') +\n       labs(colour = 'Driver Race')","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"1d970fc4ca26d73387a02625b88d0bb0f3dc8914"},"cell_type":"code","source":"options(repr.plot.width=8, repr.plot.height=4)\nggplot(data = time_data, aes(x = stop_date, y = is_arrested / count, colour = driver_race)) + \n       geom_line(size = 0.60) +\n       ggtitle('Rate of Arrest After Stop') +\n       xlab('Stop Date') +\n       ylab('Arrest Rate') +\n       labs(colour = 'Driver Race')","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"e6c251597172296f6794c1aa6e8faa5e8c83b4d5"},"cell_type":"code","source":"options(repr.plot.width=8, repr.plot.height=4)\nggplot(data = time_data,\n       aes(x = stop_date,\n           y = contraband_found / (search_conducted - contraband_missing),\n           colour = driver_race)) + \n       geom_line(size = 0.60) +\n       ggtitle('(Known) Contraband Hit rates') +\n       xlab('Stop Date') +\n       ylab('Hit Rate') +\n       labs(colour = 'Driver Race')","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"92b31ab66e65b38e250ae9f3e7a33d29fb0aa614"},"cell_type":"code","source":"options(repr.plot.width=8, repr.plot.height=4)\nggplot(data = time_data, aes(x = stop_date, y = count, colour = driver_race)) + \n       geom_line(size = 0.60) +\n       ggtitle('Number of stops by Race') +\n       xlab('Stop Date') +\n       ylab('Number of Stops') +\n       labs(colour = 'Driver Race')","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"1ebd875abcd67bf3957d06ea6cd22c5cea6945f8"},"cell_type":"code","source":"options(repr.plot.width=8, repr.plot.height=4)\nggplot(data = time_data, aes(x = stop_date, y = search_conducted, colour = driver_race)) + \n       geom_line(size = 0.60) +\n       ggtitle('Number of searches by Race') +\n       xlab('Stop Date') +\n       ylab('Number of Searches') +\n       labs(colour = 'Driver Race')","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"75d45258a6721d0000b8da1e9f53b4e3f92a35e3"},"cell_type":"code","source":"options(repr.plot.width=8, repr.plot.height=4)\nggplot(data = time_data, aes(x = stop_date, y = contraband_found, colour = driver_race)) + \n       geom_line(size = 0.60) +\n       ggtitle('Count of contraband by Race') +\n       xlab('Stop Date') +\n       ylab('(Known) Contraband Count') +\n       labs(colour = 'Driver Race')","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"77ea9091a42a0be08abed603ae1ac84a35fbfecb"},"cell_type":"code","source":"sort( sapply(ls(),function(x){object.size(get(x))})) ","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"63b39a544fccc1066ecd4fda985e3b6250eab75f"},"cell_type":"markdown","source":"**Parameter estimates and simulations**"},{"metadata":{"trusted":true,"_uuid":"a3406ea1558fbdd3d8fa279db37bdc063dbed0bc"},"cell_type":"code","source":"#proportion of males in the data\nmean(data$driver_gender)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"6c109c801b37ca285ced15ecad47e374c93877f3"},"cell_type":"code","source":"srch_rate <- mean(data$search_conducted)\nwht_srch_rate <- mean(data[data$driver_race == 'White', ]$search_conducted)\nhis_srch_rate <- mean(data[data$driver_race == 'Hispanic', ]$search_conducted)\nblk_srch_rate <- mean(data[data$driver_race == 'Black', ]$search_conducted)\nasn_srch_rate <- mean(data[data$driver_race == 'Asian', ]$search_conducted)\notr_srch_rate <- mean(data[data$driver_race == 'Other', ]$search_conducted)\n\ncat(sprintf('Search Rate (All): %f\\n', srch_rate))\ncat(sprintf('Search Rate (Whites): %f\\n', wht_srch_rate))\ncat(sprintf('Search Rate (Hispanics): %f\\n', his_srch_rate))\ncat(sprintf('Search Rate (Blacks): %f\\n', blk_srch_rate))\ncat(sprintf('Search Rate (Asians): %f\\n', asn_srch_rate))\ncat(sprintf('Search Rate (Other): %f\\n', otr_srch_rate))","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"19754cbf98f390bc5567214dee1248031a8e6139"},"cell_type":"code","source":"n_stops <- dim(data)[1]\nn_search <- sum(data$search_conducted)\nn_hits <- sum(data$contraband_found, na.rm = TRUE)\nsrch_rate <- n_search / n_stops\nhit_rate <- n_hits / n_search\n#plot the posterior distribution\n#prior is beta(1/2, 1/2)\nsrch_samples <- rbeta(n = 5000, shape1 = n_search + 1/2, shape2 = n_stops - n_search + 1/2)\nhit_samples <- rbeta(n = 5000, shape1 = n_hits + 1/2, shape2 = n_search - n_hits + 1/2)\n\nggplot() + \n    geom_density(aes(x = srch_samples), \n                   alpha = 0.65, \n                   fill = 'blue') +\n    xlab('Search Rate') +\n    geom_vline(xintercept = srch_rate) +\n    geom_text(x = srch_rate, label = srch_rate)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"41a41e7bd9fa735d73aa27f39d765159e064b63d"},"cell_type":"code","source":"ggplot() + \n    geom_density(aes(x = hit_samples), \n                   alpha = 0.45,\n                   fill = 'red') +\n    xlab('Hit Rate') +\n    geom_vline(xintercept = hit_rate) +\n    geom_text(x = hit_rate, label =  hit_rate)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"3395ddc12c677aec448ed19a92466a273756a5fd"},"cell_type":"code","source":"wht_n_stop <- dim(data[data$driver_race == 'White', ])[1]\nwht_n_search <- sum(data[data$driver_race == 'White', ]$search_conducted)\nwht_srch_rate <- wht_n_search / wht_n_stop\n\nhis_n_stop <- dim(data[data$driver_race == 'Hispanic', ])[1]\nhis_n_search <- sum(data[data$driver_race == 'Hispanic', ]$search_conducted)\nhis_srch_rate <- his_n_search / his_n_stop\n\nblk_n_stop <- dim(data[data$driver_race == 'Black', ])[1]\nblk_n_search <- sum(data[data$driver_race == 'Black', ]$search_conducted)\nblk_srch_rate <- blk_n_search / blk_n_stop\n\nasn_n_stop <- dim(data[data$driver_race == 'Asian', ])[1]\nasn_n_search <- sum(data[data$driver_race == 'Asian', ]$search_conducted)\nasn_srch_rate <- asn_n_search / asn_n_stop\n\notr_n_stop <- dim(data[data$driver_race == 'Other'])[1]\notr_n_search <- sum(data[data$driver_race == 'Other', ]$search_conducted)\notr_srch_rate <- otr_n_search / otr_n_stop\n\n## MAKE AND PLOT PRIOR DISTRIBUTION OF SEARCH RATES FOR EACH RACE\n## REPEAT THE SAME PROCESS IN ANOTHER BLOCK FOR THE HIT RATES\n\nwhite_est <- data.frame(length = rbeta(n = 2000, \n                                       shape1 = wht_n_search + 1/2, \n                                       shape2 = wht_n_stop - wht_n_search + 1/2))\nblack_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = blk_n_search + 1/2,\n                                          shape2 = blk_n_stop - blk_n_search + 1/2))\n\nhispanic_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = his_n_search + 1/2,\n                                          shape2 = his_n_stop - his_n_search + 1/2))\n\nasian_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = asn_n_search + 1/2,\n                                          shape2 = asn_n_stop - asn_n_search + 1/2))\n\nother_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = otr_n_search + 1/2,\n                                          shape2 = otr_n_stop - otr_n_search + 1/2))\n\nwhite_est$race <- 'White'\nblack_est$race <- 'Black'\nasian_est$race <- 'Asian'\nhispanic_est$race <- 'Hispanic'\nother_est$race <- 'Other'\n\nsim_data <- rbind(white_est, \n                  black_est, \n                  asian_est, \n                  hispanic_est, \n                  other_est)\n\nggplot(sim_data, aes(length, fill = race)) + \n    geom_density(alpha = 0.60) +\n    xlab('Posterior distribution for Pr(Search|Stop & Race)')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"28f2b6f1d38d025b61d802d16b66c815a9d191bd"},"cell_type":"markdown","source":"The following analyses will be done with complete case analysis"},{"metadata":{"trusted":true,"_uuid":"91899703b25fb6ad4b50af4ea246a090dc02211d"},"cell_type":"code","source":"data <- data[complete.cases(data[, 'contraband_found']),]","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"1f765aa01ef9e591bcdf12df4edbb49e8a365d04"},"cell_type":"code","source":"wht_n_hits <- sum(data[data$driver_race == 'White' &\n                             data$search_conducted == 1, ]$contraband_found)\nwht_hit_rate <- wht_n_hits / wht_n_search\n\nhis_n_hits <- sum(data[data$driver_race == 'Hispanic' &\n                             data$search_conducted == 1, ]$contraband_found)\nhis_hit_rate <- his_n_hits / his_n_search \n\nblk_n_hits <- sum(data[data$driver_race == 'Black' &\n                             data$search_conducted == 1, ]$contraband_found)\nblk_hit_rate <- blk_n_hits / blk_n_search\n\nasn_n_hits <- sum(data[data$driver_race == 'Asian' &\n                             data$search_conducted == 1, ]$contraband_found)\nasn_hit_rate <- asn_n_hits / asn_n_search\n\notr_n_hits <- sum(data[data$driver_race == 'Other' & \n                             data$search_conducted == 1, ]$contraband_found)\notr_hit_rate <- otr_n_hits / otr_n_search \n\n## MAKE AND PLOT PRIOR DISTRIBUTION OF SEARCH RATES FOR EACH RACE\n## REPEAT THE SAME PROCESS IN ANOTHER BLOCK FOR THE HIT RATES\n\nwhite_est <- data.frame(length = rbeta(n = 2000, \n                                       shape1 = wht_n_hits + 1/2, \n                                       shape2 = wht_n_search - wht_n_hits + 1/2))\nblack_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = blk_n_hits + 1/2,\n                                          shape2 = blk_n_search - blk_n_hits + 1/2))\n\nhispanic_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = his_n_hits + 1/2,\n                                          shape2 = his_n_search - his_n_hits + 1/2))\n\nasian_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = asn_n_hits + 1/2,\n                                          shape2 = asn_n_search - asn_n_hits + 1/2))\n\nother_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = otr_n_hits + 1/2,\n                                          shape2 = otr_n_search - otr_n_hits + 1/2))\n\nwhite_est$race <- 'White'\nblack_est$race <- 'Black'\nasian_est$race <- 'Asian'\nhispanic_est$race <- 'Hispanic'\nother_est$race <- 'Other'\n\nsim_data <- rbind(white_est, \n                  black_est, \n                  asian_est, \n                  hispanic_est, \n                  other_est)\n\nggplot(sim_data, aes(length, fill = race)) + \n    geom_density(alpha = 0.60) +\n    geom_vline(xintercept = wht_hit_rate, linetype = 'dashed') +\n    geom_vline(xintercept = blk_hit_rate, linetype = 'dashed') +\n    geom_vline(xintercept = asn_hit_rate, linetype = 'dashed') +\n    geom_vline(xintercept = otr_hit_rate, linetype = 'dashed') +\n    geom_vline(xintercept = his_hit_rate, linetype = 'dashed') +\n    xlab('Posterior distribution for Pr(Contraband|Search & Race)')","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"2fab918be5b527c43d7ab2c053db73bc3ecdcacd"},"cell_type":"code","source":"wht_n_search <- sum(data[data$driver_race == 'White' &\n                               data$driver_age_raw == '2', ]$search_conducted)\n\nwht_n_hits <- sum(data[data$driver_race == 'White' &\n                             data$search_conducted == 1 &\n                             data$driver_age_raw == '2', ]$contraband_found)\nwht_hit_rate <- wht_n_hits / wht_n_search\n\nhis_n_search <- sum(data[data$driver_race == 'Hispanic' &\n                               data$driver_age_raw == '2', ]$search_conducted)\n\nhis_n_hits <- sum(data[data$driver_race == 'Hispanic' &\n                             data$search_conducted == 1 &\n                             data$driver_age_raw == '2', ]$contraband_found)\nhis_hit_rate <- his_n_hits / his_n_search \n\nblk_n_search <- sum(data[data$driver_race == 'Black' &\n                               data$driver_age_raw == '2', ]$search_conducted)\n\nblk_n_hits <- sum(data[data$driver_race == 'Black' &\n                             data$search_conducted == 1 &\n                             data$driver_age_raw == '2', ]$contraband_found)\nblk_hit_rate <- blk_n_hits / blk_n_search\n\nasn_n_search <- sum(data[data$driver_race == 'Asian' &\n                               data$driver_age_raw == '2', ]$search_conducted)\n\nasn_n_hits <- sum(data[data$driver_race == 'Asian' &\n                             data$search_conducted == 1 &\n                             data$driver_age_raw == '2', ]$contraband_found)\nasn_hit_rate <- asn_n_hits / asn_n_search\n\notr_n_search <- sum(data[data$driver_race == 'Other' & \n                               data$driver_age_raw == '2', ]$search_conducted)\n\notr_n_hits <- sum(data[data$driver_race == 'Other' & \n                             data$search_conducted == 1 &\n                             data$driver_age_raw == '2', ]$contraband_found)\notr_hit_rate <- otr_n_hits / otr_n_search \n\n## MAKE AND PLOT PRIOR DISTRIBUTION OF SEARCH RATES FOR EACH RACE\n## REPEAT THE SAME PROCESS IN ANOTHER BLOCK FOR THE HIT RATES\n\nwhite_est <- data.frame(length = rbeta(n = 2000, \n                                       shape1 = wht_n_hits + 1/2, \n                                       shape2 = wht_n_search - wht_n_hits + 1/2))\nblack_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = blk_n_hits + 1/2,\n                                          shape2 = blk_n_search - blk_n_hits + 1/2))\n\nhispanic_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = his_n_hits + 1/2,\n                                          shape2 = his_n_search - his_n_hits + 1/2))\n\nasian_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = asn_n_hits + 1/2,\n                                          shape2 = asn_n_search - asn_n_hits + 1/2))\n\nother_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = otr_n_hits + 1/2,\n                                          shape2 = otr_n_search - otr_n_hits + 1/2))\n\nwhite_est$race <- 'White'\nblack_est$race <- 'Black'\nasian_est$race <- 'Asian'\nhispanic_est$race <- 'Hispanic'\nother_est$race <- 'Other'\n\nsim_data <- rbind(white_est, \n                  black_est, \n                  asian_est, \n                  hispanic_est, \n                  other_est)\n\nggplot(sim_data, aes(length, fill = race)) + \n    geom_density(alpha = 0.60) +\n    geom_vline(xintercept = wht_hit_rate, linetype = 'dashed') +\n    geom_vline(xintercept = blk_hit_rate, linetype = 'dashed') +\n    geom_vline(xintercept = asn_hit_rate, linetype = 'dashed') +\n    geom_vline(xintercept = otr_hit_rate, linetype = 'dashed') +\n    geom_vline(xintercept = his_hit_rate, linetype = 'dashed') +\n    xlab('Posterior distribution for Pr(Contraband|Search & Race & 15-25 y/o)')","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"4623c053a861b4b9a573e644bb080589cff87f25"},"cell_type":"code","source":"wht_n_search <- sum(data[data$driver_race == 'White' &\n                               data$driver_age_raw == '3', ]$search_conducted)\n\nwht_n_hits <- sum(data[data$driver_race == 'White' &\n                             data$search_conducted == 1 &\n                             data$driver_age_raw == '3', ]$contraband_found)\nwht_hit_rate <- wht_n_hits / wht_n_search\n\nhis_n_search <- sum(data[data$driver_race == 'Hispanic' &\n                               data$driver_age_raw == '3', ]$search_conducted)\n\nhis_n_hits <- sum(data[data$driver_race == 'Hispanic' &\n                             data$search_conducted == 1 &\n                             data$driver_age_raw == '3', ]$contraband_found)\nhis_hit_rate <- his_n_hits / his_n_search \n\nblk_n_search <- sum(data[data$driver_race == 'Black' &\n                               data$driver_age_raw == '3', ]$search_conducted)\n\nblk_n_hits <- sum(data[data$driver_race == 'Black' &\n                             data$search_conducted == 1 &\n                             data$driver_age_raw == '3', ]$contraband_found)\nblk_hit_rate <- blk_n_hits / blk_n_search\n\nasn_n_search <- sum(data[data$driver_race == 'Asian' &\n                               data$driver_age_raw == '3', ]$search_conducted)\n\nasn_n_hits <- sum(data[data$driver_race == 'Asian' &\n                             data$search_conducted == 1 &\n                             data$driver_age_raw == '3', ]$contraband_found)\nasn_hit_rate <- asn_n_hits / asn_n_search\n\notr_n_search <- sum(data[data$driver_race == 'Other' & \n                               data$driver_age_raw == '3', ]$search_conducted)\n\notr_n_hits <- sum(data[data$driver_race == 'Other' & \n                             data$search_conducted == 1 &\n                             data$driver_age_raw == '3', ]$contraband_found)\notr_hit_rate <- otr_n_hits / otr_n_search \n\n## MAKE AND PLOT PRIOR DISTRIBUTION OF SEARCH RATES FOR EACH RACE\n## REPEAT THE SAME PROCESS IN ANOTHER BLOCK FOR THE HIT RATES\n\nwhite_est <- data.frame(length = rbeta(n = 2000, \n                                       shape1 = wht_n_hits + 1/2, \n                                       shape2 = wht_n_search - wht_n_hits + 1/2))\nblack_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = blk_n_hits + 1/2,\n                                          shape2 = blk_n_search - blk_n_hits + 1/2))\n\nhispanic_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = his_n_hits + 1/2,\n                                          shape2 = his_n_search - his_n_hits + 1/2))\n\nasian_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = asn_n_hits + 1/2,\n                                          shape2 = asn_n_search - asn_n_hits + 1/2))\n\nother_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = otr_n_hits + 1/2,\n                                          shape2 = otr_n_search - otr_n_hits + 1/2))\n\nwhite_est$race <- 'White'\nblack_est$race <- 'Black'\nasian_est$race <- 'Asian'\nhispanic_est$race <- 'Hispanic'\nother_est$race <- 'Other'\n\nsim_data <- rbind(white_est, \n                  black_est, \n                  asian_est, \n                  hispanic_est, \n                  other_est)\n\nggplot(sim_data, aes(length, fill = race)) + \n    geom_density(alpha = 0.60) +\n    geom_vline(xintercept = wht_hit_rate, linetype = 'dashed') +\n    geom_vline(xintercept = blk_hit_rate, linetype = 'dashed') +\n    geom_vline(xintercept = asn_hit_rate, linetype = 'dashed') +\n    geom_vline(xintercept = otr_hit_rate, linetype = 'dashed') +\n    geom_vline(xintercept = his_hit_rate, linetype = 'dashed') +\n    xlab('Posterior distribution for Pr(Contraband|Search & Race & 25-32 y/o)')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"0def2fd64610809cb8c45d8f61685c4467ecd838"},"cell_type":"markdown","source":"It is possible that the inclusion of individuals under suspicion of DUI may be adding a bias term to our estimates of the search and contraband rate. Suppose that a Police Officer pulls someone over for a DUI, and they actually are impaired. In this case, the officer essentially has probable cause on a silver platter, and will likely go forward with a search after arresting the driver. So, let's have a look at only those who have \"Moving Violations\". I.e., they were speeding, ran a light, or otherwise had an infraction that is fairly common on the road. We will stick to drivers who are 15-25, as they seem to carry contraband at higher rates."},{"metadata":{"trusted":true,"_uuid":"503eb54bcb83fe3480ec9a2cde6244200ba00750"},"cell_type":"code","source":"wht_n_search <- sum(data[data$driver_race == 'White' &\n                               data$driver_age_raw == '2' &\n                               violation == 2, ]$search_conducted)\n\nwht_n_hits <- sum(data[data$driver_race == 'White' &\n                             data$search_conducted == 1 &\n                             data$driver_age_raw == '2' &\n                             violation == 2, ]$contraband_found)\nwht_hit_rate <- wht_n_hits / wht_n_search\n\nhis_n_search <- sum(data[data$driver_race == 'Hispanic' &\n                               data$driver_age_raw == '2' &\n                               violation == 2, ]$search_conducted)\n\nhis_n_hits <- sum(data[data$driver_race == 'Hispanic' &\n                             data$search_conducted == 1 &\n                             data$driver_age_raw == '2' &\n                             violation ==2, ]$contraband_found)\nhis_hit_rate <- his_n_hits / his_n_search \n\nblk_n_search <- sum(data[data$driver_race == 'Black' &\n                               data$driver_age_raw == '2' &\n                               violation == 2, ]$search_conducted)\n\nblk_n_hits <- sum(data[data$driver_race == 'Black' &\n                             data$search_conducted == 1 &\n                             data$driver_age_raw == '2' &\n                             violation == 2, ]$contraband_found)\nblk_hit_rate <- blk_n_hits / blk_n_search\n\nasn_n_search <- sum(data[data$driver_race == 'Asian' &\n                               data$driver_age_raw == '2' &\n                               violation == 2, ]$search_conducted)\n\nasn_n_hits <- sum(data[data$driver_race == 'Asian' &\n                             data$search_conducted == 1 &\n                             data$driver_age_raw == '2' &\n                             violation == 2, ]$contraband_found)\nasn_hit_rate <- asn_n_hits / asn_n_search\n\notr_n_search <- sum(data[data$driver_race == 'Other' & \n                               data$driver_age_raw == '2' &\n                               violation == 2, ]$search_conducted)\n\notr_n_hits <- sum(data[data$driver_race == 'Other' & \n                             data$search_conducted == 1 &\n                             data$driver_age_raw == '2' &\n                             violation ==2, ]$contraband_found)\notr_hit_rate <- otr_n_hits / otr_n_search \n\n## MAKE AND PLOT PRIOR DISTRIBUTION OF SEARCH RATES FOR EACH RACE\n## REPEAT THE SAME PROCESS IN ANOTHER BLOCK FOR THE HIT RATES\n\nwhite_est <- data.frame(length = rbeta(n = 5000, \n                                       shape1 = wht_n_hits + 1/2, \n                                       shape2 = wht_n_search - wht_n_hits + 1/2))\nblack_est <- data.frame(length = rbeta(n = 5000, \n                                          shape1 = blk_n_hits + 1/2,\n                                          shape2 = blk_n_search - blk_n_hits + 1/2))\n\nhispanic_est <- data.frame(length = rbeta(n = 5000, \n                                          shape1 = his_n_hits + 1/2,\n                                          shape2 = his_n_search - his_n_hits + 1/2))\n\nasian_est <- data.frame(length = rbeta(n = 5000, \n                                          shape1 = asn_n_hits + 1/2,\n                                          shape2 = asn_n_search - asn_n_hits + 1/2))\n\nother_est <- data.frame(length = rbeta(n = 5000, \n                                          shape1 = otr_n_hits + 1/2,\n                                          shape2 = otr_n_search - otr_n_hits + 1/2))\n\nwhite_est$race <- 'White'\nblack_est$race <- 'Black'\nasian_est$race <- 'Asian'\nhispanic_est$race <- 'Hispanic'\nother_est$race <- 'Other'\n\nsim_data <- rbind(white_est, \n                  black_est, \n                  asian_est, \n                  hispanic_est, \n                  other_est)\n\nggplot(sim_data, aes(length, fill = race)) + \n    geom_density(alpha = 0.60) +\n    geom_vline(xintercept = wht_hit_rate, linetype = 'dashed') +\n    geom_vline(xintercept = blk_hit_rate, linetype = 'dashed') +\n    geom_vline(xintercept = asn_hit_rate, linetype = 'dashed') +\n    geom_vline(xintercept = otr_hit_rate, linetype = 'dashed') +\n    geom_vline(xintercept = his_hit_rate, linetype = 'dashed') +\n    xlab('Posterior distribution for Pr(Contraband|Search & Race & Age & Moving Violation)')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"334bbee07598d69a8d5ffceef2f9802dbd8899a7"},"cell_type":"markdown","source":"What if we only look at those individuals who were searched because of \"probable cause\"? This is an interesting one, because \"probable cause\" is essentially a judgement made by the officer. If the officer sees a certain amount of evidence of wrong doing, they then may decide that they have \"probable cause\". The long running joke here is the officer stating \"I smell weed in your car\", then conducting a search, when maurijuana may or may not actually be present.\n\nMore or less, these are searches that were made up to the officer's personal discretion, as opposed to a search conducted in the face of a confirmed DUI, which happens essentially automatically. "},{"metadata":{"trusted":true,"_uuid":"d33ab5815df87c17a50261e6fd735443edcdeb55"},"cell_type":"code","source":"unique(data$search_type)\ndim(data[data$search_type == 'Probable Cause',])","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"b85712ecaf4223437fdf20dccf3ba9263b114622"},"cell_type":"code","source":"wht_n_search <- sum(data[data$driver_race == 'White' &\n                         data$search_type == 'Probable Cause', ]$search_conducted)\n\nwht_n_hits <- sum(data[data$driver_race == 'White' &\n                             data$search_conducted == 1 &\n                             data$search_type == 'Probable Cause', ]$contraband_found)\nwht_hit_rate <- wht_n_hits / wht_n_search\n\nhis_n_search <- sum(data[data$driver_race == 'Hispanic' &\n                         data$search_type == 'Probable Cause', ]$search_conducted)\n\nhis_n_hits <- sum(data[data$driver_race == 'Hispanic' &\n                       data$search_conducted == 1 &\n                       data$search_type == 'Probable Cause', ]$contraband_found)\nhis_hit_rate <- his_n_hits / his_n_search \n\nblk_n_search <- sum(data[data$driver_race == 'Black' &\n                         data$search_type == 'Probable Cause', ]$search_conducted)\n\nblk_n_hits <- sum(data[data$driver_race == 'Black' &\n                       data$search_conducted == 1 &\n                       data$search_type == 'Probable Cause', ]$contraband_found)\nblk_hit_rate <- blk_n_hits / blk_n_search\n\nasn_n_search <- sum(data[data$driver_race == 'Asian' &\n                         data$search_type == 'Probable Cause', ]$search_conducted)\n\nasn_n_hits <- sum(data[data$driver_race == 'Asian' &\n                       data$search_conducted == 1 &\n                       data$search_type == 'Probable Cause', ]$contraband_found)\nasn_hit_rate <- asn_n_hits / asn_n_search\n\notr_n_search <- sum(data[data$driver_race == 'Other' & \n                         data$search_type == 'Probable Cause', ]$search_conducted)\n\notr_n_hits <- sum(data[data$driver_race == 'Other' & \n                       data$search_conducted == 1 &\n                       data$search_type == 'Probable Cause', ]$contraband_found)\notr_hit_rate <- otr_n_hits / otr_n_search \n\n## MAKE AND PLOT PRIOR DISTRIBUTION OF SEARCH RATES FOR EACH RACE\n## REPEAT THE SAME PROCESS IN ANOTHER BLOCK FOR THE HIT RATES\n\nwhite_est <- data.frame(length = rbeta(n = 2000, \n                                       shape1 = wht_n_hits + 1/2, \n                                       shape2 = wht_n_search - wht_n_hits + 1/2))\nblack_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = blk_n_hits + 1/2,\n                                          shape2 = blk_n_search - blk_n_hits + 1/2))\n\nhispanic_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = his_n_hits + 1/2,\n                                          shape2 = his_n_search - his_n_hits + 1/2))\n\nasian_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = asn_n_hits + 1/2,\n                                          shape2 = asn_n_search - asn_n_hits + 1/2))\n\nother_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = otr_n_hits + 1/2,\n                                          shape2 = otr_n_search - otr_n_hits + 1/2))\n\nwhite_est$race <- 'White'\nblack_est$race <- 'Black'\nasian_est$race <- 'Asian'\nhispanic_est$race <- 'Hispanic'\nother_est$race <- 'Other'\n\nsim_data <- rbind(white_est, \n                  black_est, \n                  asian_est, \n                  hispanic_est, \n                  other_est)\n\nggplot(sim_data, aes(length, fill = race)) + \n    geom_density(alpha = 0.60) +\n    geom_vline(xintercept = wht_hit_rate, linetype = 'dashed') +\n    geom_vline(xintercept = blk_hit_rate, linetype = 'dashed') +\n    geom_vline(xintercept = asn_hit_rate, linetype = 'dashed') +\n    geom_vline(xintercept = otr_hit_rate, linetype = 'dashed') +\n    geom_vline(xintercept = his_hit_rate, linetype = 'dashed') +\n    xlab('Posterior distribution for Pr(Contraband|Search & Race & Probable Cause)')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"42df3beb76ad4040b9d0e1704e4d82c943738f1b"},"cell_type":"markdown","source":"The next block is the arrest rate for those stopped for a DUI violation."},{"metadata":{"trusted":true,"_uuid":"8317b3476fa68e431add8ebe1f373f4253a64f4b"},"cell_type":"code","source":"srch_rate <- mean(data[data$violation == 0,]$is_arrested)\nwht_srch_rate <- mean(data[data$driver_race == 'White' & data$violation == 0, ]$is_arrested)\nhis_srch_rate <- mean(data[data$driver_race == 'Hispanic' & data$violation == 0, ]$is_arrested)\nblk_srch_rate <- mean(data[data$driver_race == 'Black' & data$violation == 0, ]$is_arrested)\nasn_srch_rate <- mean(data[data$driver_race == 'Asian' & data$violation == 0, ]$is_arrested)\notr_srch_rate <- mean(data[data$driver_race == 'Other' & data$violation == 0, ]$is_arrested)\n\ncat(sprintf('Search Rate (All): %f\\n', srch_rate))\ncat(sprintf('Search Rate (Whites): %f\\n', wht_srch_rate))\ncat(sprintf('Search Rate (Hispanics): %f\\n', his_srch_rate))\ncat(sprintf('Search Rate (Blacks): %f\\n', blk_srch_rate))\ncat(sprintf('Search Rate (Asians): %f\\n', asn_srch_rate))\ncat(sprintf('Search Rate (Other): %f\\n', otr_srch_rate))","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"c97647c9e54dc0892815cf3a5e4f15ab772b53f5"},"cell_type":"code","source":"srch_rate <- mean(data[data$violation != 0,]$search_conducted)\nwht_srch_rate <- mean(data[data$driver_race == 'White' & data$violation != 0, ]$search_conducted)\nhis_srch_rate <- mean(data[data$driver_race == 'Hispanic' & data$violation != 0, ]$search_conducted)\nblk_srch_rate <- mean(data[data$driver_race == 'Black' & data$violation != 0, ]$search_conducted)\nasn_srch_rate <- mean(data[data$driver_race == 'Asian' & data$violation != 0, ]$search_conducted)\notr_srch_rate <- mean(data[data$driver_race == 'Other' & data$violation != 0, ]$search_conducted)\n\ncat(sprintf('Search Rate (All): %f\\n', srch_rate))\ncat(sprintf('Search Rate (Whites): %f\\n', wht_srch_rate))\ncat(sprintf('Search Rate (Hispanics): %f\\n', his_srch_rate))\ncat(sprintf('Search Rate (Blacks): %f\\n', blk_srch_rate))\ncat(sprintf('Search Rate (Asians): %f\\n', asn_srch_rate))\ncat(sprintf('Search Rate (Other): %f\\n', otr_srch_rate))","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"054bd13f3ddb99c102dc91b5a8a9e04c3c144728"},"cell_type":"markdown","source":"Now, what can we say about the missing contraband values? The first thing to notice is that every row that is missing a contraband value has `search_conducted = 1`, which is immediately suspicious. "},{"metadata":{"trusted":true,"_uuid":"04bdda3ab72fed9467ed6a0a83b839eb839889af"},"cell_type":"code","source":"sum(miss_cntrbnd$search_conducted)\ndim(miss_cntrbnd)[1]","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"dd51e159d03c864d58776196c2fd69f0ddc1b851"},"cell_type":"markdown","source":"Is there some other difference between those with a missing contraband value and those with one?"},{"metadata":{"trusted":true,"_uuid":"8f3c4e039cd4ca4f8522a62f8f20ad9ab184ca66"},"cell_type":"code","source":"unique(data$search_type)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"843351411710c9f5854c13d3b85a18b47e43f1f1"},"cell_type":"code","source":"unique(miss_cntrbnd$search_type)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"4a8f3b59ec34f63f71d77ee183f12de9f314e1e3"},"cell_type":"code","source":"n_arrested <- sum(miss_cntrbnd$is_arrested)\nn_stops <- dim(miss_cntrbnd)[1]\nn_arrested / n_stops\nn_arrested","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"294aabb9927d8555ac2f52ab69bf3c1cf6e35cc6"},"cell_type":"markdown","source":"So, it seems that those with missing contraband values have different values for the `search_type` field than those with values. Infact, these two sets are disjoint, and all the missing contraband values seem to correspond to a particular search_type. Moreover, about 63% of those with missing contraband values were arrested. Very suspicious so far. It certainly seems that we can't treat the data as missing at random.\n\nWhat can we say about the race breakdown? What can we say about the arrest rates within the race break down?"},{"metadata":{"trusted":true,"_uuid":"c40643edf4d1607089cb9a616e9bc2681d8ae46b"},"cell_type":"code","source":"n_stops <- dim(miss_cntrbnd)[1]\n\nn_whites <- dim(miss_cntrbnd[miss_cntrbnd$driver_race == 'White',])[1]\nn_blacks <- dim(miss_cntrbnd[miss_cntrbnd$driver_race == 'Black',])[1]\nn_hispanics <- dim(miss_cntrbnd[miss_cntrbnd$driver_race == 'Hispanic',])[1]\nn_asians <- dim(miss_cntrbnd[miss_cntrbnd$driver_race == 'Asian',])[1]\nn_others <- dim(miss_cntrbnd[miss_cntrbnd$driver_race == 'Other',])[1]\n\nwhite_arrests <- sum(miss_cntrbnd[miss_cntrbnd$driver_race == 'White',]$is_arrested)\nblack_arrests <- sum(miss_cntrbnd[miss_cntrbnd$driver_race == 'Black',]$is_arrested)\nhispanic_arrests <- sum(miss_cntrbnd[miss_cntrbnd$driver_race == 'Hispanic',]$is_arrested)\nasian_arrests <- sum(miss_cntrbnd[miss_cntrbnd$driver_race == 'Asian',]$is_arrested)\nother_arrests <- sum(miss_cntrbnd[miss_cntrbnd$driver_race == 'Other',]$is_arrested)\n\nwht_arr_rate <- white_arrests / n_whites\nblk_arr_rate <- black_arrests / n_blacks\nhis_arr_rate <- hispanic_arrests / n_hispanics\nasn_arr_rate <- asian_arrests / n_asians\notr_arr_rate <- other_arrests / n_others\n\n## MAKE AND PLOT PRIOR DISTRIBUTION OF SEARCH RATES FOR EACH RACE\n## REPEAT THE SAME PROCESS IN ANOTHER BLOCK FOR THE HIT RATES\n\nwhite_est <- data.frame(length = rbeta(n = 2000, \n                                       shape1 = white_arrests + 1/2, \n                                       shape2 = n_whites - white_arrests + 1/2))\nblack_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = black_arrests + 1/2,\n                                          shape2 = n_blacks - black_arrests + 1/2))\n\nhispanic_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = hispanic_arrests + 1/2,\n                                          shape2 = n_hispanics - hispanic_arrests + 1/2))\n\nasian_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = asian_arrests + 1/2,\n                                          shape2 = n_asians - asian_arrests + 1/2))\n\nother_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = other_arrests + 1/2,\n                                          shape2 = n_others - other_arrests + 1/2))\n\nwhite_est$race <- 'White'\nblack_est$race <- 'Black'\nasian_est$race <- 'Asian'\nhispanic_est$race <- 'Hispanic'\nother_est$race <- 'Other'\n\nsim_data <- rbind(white_est, \n                  black_est, \n                  asian_est, \n                  hispanic_est, \n                  other_est)\n\nggplot(sim_data, aes(length, fill = race)) + \n    geom_density(alpha = 0.60) +\n    geom_vline(xintercept = wht_arr_rate, linetype = 'dashed') +\n    geom_vline(xintercept = blk_arr_rate, linetype = 'dashed') +\n    geom_vline(xintercept = asn_arr_rate, linetype = 'dashed') +\n    geom_vline(xintercept = otr_arr_rate, linetype = 'dashed') +\n    geom_vline(xintercept = his_arr_rate, linetype = 'dashed') +\n    xlab('Posterior distribution for Arrest Probability')","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"26d37cd6fb95117aff5507b996d5684007238604"},"cell_type":"code","source":"\n\nwhite_arrest / n_whites\nblack_arrest / n_blacks\nhispanic_arrest / n_hispanics\nasian_arrest / n_asians\nother_arrest / n_others","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"a5aa94bceeee616e4431cbf720809ac8ea3b66d5"},"cell_type":"markdown","source":"So, this is still pretty interesting. When we stratify by race, the arrest rates are WAY higher for asians and whites than they are for blacks or hispanics, but everyone in this subset of data *was* searched. Why would this happen?"},{"metadata":{"_uuid":"42e8e9844100e66ba328418ecf54ebe49cc1dae2"},"cell_type":"markdown","source":"What would happen if we knew the data? How would our estimates and uncertainty change? We can try \"imputing\" the data with different values into our probability model from before and look at how those estimates change. We can try a couple different models.  First, let's suppose that everyone who has a missing contraband value actually *did* have contraband, and throw this into the model. Since everyone with a missing contraband value was searched, we can simply add the number of data points (by race) to our estimates from before."},{"metadata":{"trusted":true,"_uuid":"32fe74412b2a01d6087f759ceffde450d099ab8a"},"cell_type":"code","source":"wht_n_hits <- sum(data[data$driver_race == 'White' &\n                       data$search_conducted == 1, ]$contraband_found) + n_whites\nwht_n_search <- sum(data[data$driver_race == 'White' &\n                         data$search_conducted == 1, ]$search_conducted) + n_whites\nwht_hit_rate <- wht_n_hits / wht_n_search\n\n\n\nhis_n_hits <- sum(data[data$driver_race == 'Hispanic' &\n                             data$search_conducted == 1, ]$contraband_found) + n_hispanics\nhis_n_search <- sum(data[data$driver_race == 'Hispanic' &\n                         data$search_conducted == 1, ]$search_conducted) + n_hispanics\nhis_hit_rate <- his_n_hits / his_n_search\n\n\n\nblk_n_hits <- sum(data[data$driver_race == 'Black' &\n                             data$search_conducted == 1, ]$contraband_found) + n_blacks\nblk_n_search <- sum(data[data$driver_race == 'Black' &\n                         data$search_conducted == 1, ]$search_conducted) + n_blacks\nblk_hit_rate <- blk_n_hits / blk_n_search\n\n\n\nasn_n_hits <- sum(data[data$driver_race == 'Asian' &\n                             data$search_conducted == 1, ]$contraband_found) + n_asians\nasn_n_search <- sum(data[data$driver_race == 'Asian' &\n                         data$search_conducted == 1, ]$search_conducted) + n_asians\nasn_hit_rate <- asn_n_hits / asn_n_search\n\n\notr_n_hits <- sum(data[data$driver_race == 'Other' & \n                             data$search_conducted == 1, ]$contraband_found) + n_others\notr_n_search <- sum(data[data$driver_race == 'Other' &\n                         data$search_conducted == 1, ]$search_conducted) + n_others\notr_hit_rate <- otr_n_hits / otr_n_search\n\n## MAKE AND PLOT PRIOR DISTRIBUTION OF SEARCH RATES FOR EACH RACE\n## REPEAT THE SAME PROCESS IN ANOTHER BLOCK FOR THE HIT RATES\n\nwhite_est <- data.frame(length = rbeta(n = 2000, \n                                       shape1 = wht_n_hits + 1/2, \n                                       shape2 = wht_n_search - wht_n_hits + 1/2))\nblack_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = blk_n_hits + 1/2,\n                                          shape2 = blk_n_search - blk_n_hits + 1/2))\n\nhispanic_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = his_n_hits + 1/2,\n                                          shape2 = his_n_search - his_n_hits + 1/2))\n\nasian_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = asn_n_hits + 1/2,\n                                          shape2 = asn_n_search - asn_n_hits + 1/2))\n\nother_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = otr_n_hits + 1/2,\n                                          shape2 = otr_n_search - otr_n_hits + 1/2))\n\nwhite_est$race <- 'White'\nblack_est$race <- 'Black'\nasian_est$race <- 'Asian'\nhispanic_est$race <- 'Hispanic'\nother_est$race <- 'Other'\n\nsim_data <- rbind(white_est, \n                  black_est, \n                  asian_est, \n                  hispanic_est, \n                  other_est)\n\nggplot(sim_data, aes(length, fill = race)) + \n    geom_density(alpha = 0.60) +\n    geom_vline(xintercept = wht_hit_rate, linetype = 'dashed') +\n    geom_vline(xintercept = blk_hit_rate, linetype = 'dashed') +\n    geom_vline(xintercept = asn_hit_rate, linetype = 'dashed') +\n    geom_vline(xintercept = otr_hit_rate, linetype = 'dashed') +\n    geom_vline(xintercept = his_hit_rate, linetype = 'dashed') +\n    xlab('Posterior distribution for Pr(Contraband|Search & Race)')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"54be26ab942c73e9b4a56658481d0eb58fe98e89"},"cell_type":"markdown","source":"This is likely not too useful. We see that blacks would still carry contraband at a lower rate than whites, but the differences are pretty small, on the order of a 0.005 change in probability. However, there is little uncertainty in this change due to how many data points we have. While the difference is small, we could be relatively sure that it exists *if* our experiment were exactly true.\n\nSuppose now that everyone who was initially missing their contraband was actually arrested *because* they had contraband. This is not totally unreasonable, as every one of those people were searched, and so the police likely had some suspicion they were carrying contraband. \n\nWe can do this simply by adding the arrest number to the number of hits, and keeping everything else the same. Here, the number of arrests is serving as a proxy for contraband."},{"metadata":{"trusted":true,"_uuid":"dfb50ba48a9d483ab834b2c7e81be03c58678164"},"cell_type":"code","source":"wht_n_hits <- sum(data[data$driver_race == 'White' &\n                       data$search_conducted == 1, ]$contraband_found) + white_arrests\nwht_n_search <- sum(data[data$driver_race == 'White' &\n                         data$search_conducted == 1, ]$search_conducted) + n_whites\nwht_hit_rate <- wht_n_hits / wht_n_search\n\n\n\nhis_n_hits <- sum(data[data$driver_race == 'Hispanic' &\n                             data$search_conducted == 1, ]$contraband_found) + hispanic_arrests\nhis_n_search <- sum(data[data$driver_race == 'Hispanic' &\n                         data$search_conducted == 1, ]$search_conducted) + n_hispanics\nhis_hit_rate <- his_n_hits / his_n_search\n\n\n\nblk_n_hits <- sum(data[data$driver_race == 'Black' &\n                             data$search_conducted == 1, ]$contraband_found) + black_arrests\nblk_n_search <- sum(data[data$driver_race == 'Black' &\n                         data$search_conducted == 1, ]$search_conducted) + n_blacks\nblk_hit_rate <- blk_n_hits / blk_n_search\n\n\n\nasn_n_hits <- sum(data[data$driver_race == 'Asian' &\n                             data$search_conducted == 1, ]$contraband_found) + asian_arrests\nasn_n_search <- sum(data[data$driver_race == 'Asian' &\n                         data$search_conducted == 1, ]$search_conducted) + n_asians\nasn_hit_rate <- asn_n_hits / asn_n_search\n\n\notr_n_hits <- sum(data[data$driver_race == 'Other' & \n                             data$search_conducted == 1, ]$contraband_found) + other_arrests\notr_n_search <- sum(data[data$driver_race == 'Other' &\n                         data$search_conducted == 1, ]$search_conducted) + n_others\notr_hit_rate <- otr_n_hits / otr_n_search\n\n## MAKE AND PLOT PRIOR DISTRIBUTION OF SEARCH RATES FOR EACH RACE\n## REPEAT THE SAME PROCESS IN ANOTHER BLOCK FOR THE HIT RATES\n\nwhite_est <- data.frame(length = rbeta(n = 2000, \n                                       shape1 = wht_n_hits + 1/2, \n                                       shape2 = wht_n_search - wht_n_hits + 1/2))\nblack_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = blk_n_hits + 1/2,\n                                          shape2 = blk_n_search - blk_n_hits + 1/2))\n\nhispanic_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = his_n_hits + 1/2,\n                                          shape2 = his_n_search - his_n_hits + 1/2))\n\nasian_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = asn_n_hits + 1/2,\n                                          shape2 = asn_n_search - asn_n_hits + 1/2))\n\nother_est <- data.frame(length = rbeta(n = 2000, \n                                          shape1 = otr_n_hits + 1/2,\n                                          shape2 = otr_n_search - otr_n_hits + 1/2))\n\nwhite_est$race <- 'White'\nblack_est$race <- 'Black'\nasian_est$race <- 'Asian'\nhispanic_est$race <- 'Hispanic'\nother_est$race <- 'Other'\n\nsim_data <- rbind(white_est, \n                  black_est, \n                  asian_est, \n                  hispanic_est, \n                  other_est)\n\nggplot(sim_data, aes(length, fill = race)) + \n    geom_density(alpha = 0.60) +\n    geom_vline(xintercept = wht_hit_rate, linetype = 'dashed') +\n    geom_vline(xintercept = blk_hit_rate, linetype = 'dashed') +\n    geom_vline(xintercept = asn_hit_rate, linetype = 'dashed') +\n    geom_vline(xintercept = otr_hit_rate, linetype = 'dashed') +\n    geom_vline(xintercept = his_hit_rate, linetype = 'dashed') +\n    xlab('Posterior distribution for Pr(Contraband|Search & Race)')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"5f7fbaed560e3916fedec27731971de9e275e846"},"cell_type":"markdown","source":"It looks like now our estimates have a much larger difference, and in fact, Asians would have the highest probability of carrying contraband given that the police officer has decided to search them! In second place are Whites, with Hispanics and Blacks in last place. \n\n\n##TODO: formal random imputation of the missing values, conduct analysis then. Perhaps use propensity scores as well?"}],"metadata":{"kernelspec":{"display_name":"R","language":"R","name":"ir"},"language_info":{"mimetype":"text/x-r-source","name":"R","pygments_lexer":"r","version":"3.4.2","file_extension":".r","codemirror_mode":"r"}},"nbformat":4,"nbformat_minor":1}